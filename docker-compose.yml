services:
  monolith-ht:
    build:
      context: .
      dockerfile: Dockerfile
    image: ht-base:local
    container_name: ht-base
    ports:
      - "8000:8000"   # REST API
      - "7681:7681"   # ht live preview
    environment:
      - DATA_DIR=/data
      - HT_LISTEN=0.0.0.0:7681
      - MONOLITH_FLAGS=${MONOLITH_FLAGS:-}
    volumes:
      - ./data:/data
    develop:
      watch:
        # Rebuild image and restart when source changes
        - action: rebuild
          path: .
          ignore:
            - data/**
            - .git/**
            - .venv/**
            - __pycache__/**
            - .pytest_cache/**
            - tests/**
            - ht.md
            - monolith.md
